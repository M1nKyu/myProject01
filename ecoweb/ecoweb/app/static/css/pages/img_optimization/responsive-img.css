/* Responsive overrides for Image Optimization page (non-destructive)
   Goal: when viewport narrows, content shrinks from center, not pushed left. */

:root {
  --img-container-max: 1600px;
  --img-canvas-max: 1920px; /* match design canvas to center absolute children */
}

/* Center the whole page canvas so absolutely positioned children stay centered */
.img-op {
  max-width: var(--img-canvas-max);
  width: min(var(--img-canvas-max), 100%);
  margin-left: auto;
  margin-right: auto;
  position: relative; /* keep as anchor for absolute children */
}

/* Ensure Section01 visually clips its canvas within the white box */
.img-op-section01 { overflow: hidden; }

/* Section01: ensure canvas is positioned within the wrapper at all widths */
.img-op-section01 .section01-scale-wrapper {
  /* scale factor set via JS; default to 1 */
  --s: 1;
  position: relative; /* anchor for absolute canvas */
  width: 100%;
  margin: 0 auto;
  /* maintain scaled height for layout flow; original height 580px */
  height: calc(580px * var(--s));
}
.img-op-section01 .img-op-section01-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 1020px; /* original canvas size */
  height: 580px; /* original canvas size */
  transform-origin: top left;
  transform: scale(var(--s));
}

/* Responsive layout (<=1600px): release absolute layout, keep centered */
@media (max-width: 1600px) {
  .img-op { 
    overflow: visible !important; height: auto !important;
    padding: 20px;
  }

  /* Title becomes normal flow */
  .img-op .div1 {
    position: static !important;
    margin: 0 0 8px 0; /* 최상위 부모 패딩 사용, 하단 마진만 유지 */
  }

  /* Generic section blocks: make fluid, centered, stacked */
  .img-op-section02,
  .img-op-section03,
  .img-op-section04,
  .img-op-section05,
  .img-op-section06 {
    position: static !important;
    width: 100% !important;
    max-width: var(--img-container-max);
    height: auto !important;
    margin: 0 auto 16px auto !important;
    box-sizing: border-box;
    overflow: visible !important;
  }
  .img-op-section01 {
    position: static !important;
    width: 100% !important;
    max-width: var(--img-container-max);
    margin: 0 auto 16px auto !important;
    padding: 16px 14px 18px 14px; /* safe padding */
    box-sizing: border-box;
    overflow: visible !important;
    height: auto !important; /* allow box to grow with scaled wrapper */
  }

  /* Section01 should keep clipping its internal absolute canvas */
  .img-op-section01 { overflow: hidden !important; }

  /* Section01: center-scale the original absolute layout like a captured canvas */
  .img-op-section01 { padding-inline: 20px !important; }
  .img-op-section01 .section01-scale-wrapper {
    position: relative;
    width: 100%;
    max-width: var(--img-container-max);
    margin: 0 auto;
    /* maintain scaled height for layout flow; original height 580px */
    height: calc(580px * var(--s));
  }
  .img-op-section01 .img-op-section01-canvas {
    position: absolute !important;
    top: 0;
    left: 0;
    width: 1020px;
    height: 580px;
    transform-origin: top left;
    transform: scale(var(--s)) !important;
  }

  /* Section01 specific: stack internal items */
  .img-op-section01 > *:not(.section01-scale-wrapper):not(.img-op-section01-canvas) {
    position: static !important;
    margin: 6px 0;
  }
  .img-op-section01 .img-op-section01-graph,
  .img-op-section01 .img-op-secion01-reduction-percent,
  .img-op-section01 .img-op-section01-reduction-weight { width: 100% !important; max-width: 100% !important; }

  /* Section02: 이미지 컨테이너 반응형 처리 (이미 위에서 처리됨) */

  /* Section03: 1 row 2 columns layout with square boxes */
  .img-op-section03 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px 20px; /* row-gap column-gap */
  }
  .img-op-section03 .section03-item {
    position: static !important;
    width: 100% !important;
    aspect-ratio: 1 / 1; /* maintain square shape */
    border-radius: 12px;
    background-color: #fff;
    padding: 20px;
    box-sizing: border-box;
    /* Make box a vertical stack: top metrics and bottom label */
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* push bottom block to the bottom */
  }
  .img-op-section03 .section03-item.current {
    margin-right: 0; /* remove margin in responsive grid */
  }
  .img-op-section03 .section03-value,
  .img-op-section03 .section03-title,
  .img-op-section03 .p {
    position: static !important;
    margin: 0;
  }
  /* Optional: ensure bottom text group hugs the bottom tightly */
  .img-op-section03 .section03-title { margin-top: 8px; }

  /* Section04: simple 2 rows layout in responsive */
  .img-op-section04 {
    position: static !important;
    width: 100% !important;
    max-width: var(--img-container-max);
    height: auto !important;
    margin: 0 auto 16px auto !important;
    padding: 20px !important;
    box-sizing: border-box;
  }

  /* Section04: title at the top */
  .img-op-section04 .section04-title {
    position: static !important;
    display: block !important;
    margin: 0 0 16px 0 !important;
  }

  /* Section04: stack two sections in rows */
  .img-op-section04 .section04-total-image,
  .img-op-section04 .section04-possible-optimization {
    display: block !important;
    position: relative !important;
    width: 100% !important;
    height: auto !important;
    margin: 0 !important;
    margin-bottom: 20px !important;
  }

  /* Images with responsive sizing */
  .img-op-section04 .section04-total-image .section04-image-icon {
    position: relative !important;
    display: inline-block !important;
    vertical-align: middle !important;
    width: 40% !important;
    height: 40% !important;
    top: 0 !important;
    object-fit: contain !important;
  }

  .img-op-section04 .section04-possible-optimization .section04-image-icon {
    position: relative !important;
    display: inline-block !important;
    vertical-align: middle !important;
    width: 30% !important;
    height: 30% !important;
    top: 0 !important;
    object-fit: contain !important;
  }

  /* Text wrapper inline with image */
  .img-op-section04 .section04-total-image .section04-text-wrapper,
  .img-op-section04 .section04-possible-optimization .section04-text-wrapper {
    position: relative !important;
    display: inline-block !important;
    vertical-align: middle !important;
    bottom: 10px !important;
  }

  /* Individual left positioning for text alignment */
  .img-op-section04 .section04-total-image .section04-text-wrapper {
    left: 4px !important;
  }

  .img-op-section04 .section04-possible-optimization .section04-text-wrapper {
    left: 40px !important;
  }

  /* Responsive typography with fluid sizing and tight line spacing */
  .img-op-section04 .section04-text-title {
    font-size: clamp(12px, 4vw, 24px) !important;
    margin-bottom: 3px !important;
    line-height: 1.2 !important;
  }
  .img-op-section04 .section04-text-value {
    font-size: clamp(28px, 10vw, 84px) !important;
    margin-bottom: 4px !important;
    line-height: 1.1 !important;
  }
  .img-op-section04 .section04-text-description {
    font-size: clamp(11px, 3vw, 20px) !important;
    margin-bottom: 0 !important;
    line-height: 1.3 !important;
  }

  /* Section05 & Section06: ensure consistent outer left/right spacing */
  .img-op-section05,
  .img-op-section06 {
    margin-inline: 20px;
  }
  /* Section05 heading and counter: place into normal flow */
  .img-op-section05 .div15 { position: static !important; margin: 0 0 8px 0; font-weight: 600; }
  .img-op-section05 .bytes-38 { position: static !important; margin: 0 0 12px 0; color: #878a93; }

  /* Section02: image scales fluidly with proper aspect ratio */
  .img-op-section02 { 
    display: block !important; 
    padding: 20px !important; 
    box-sizing: border-box; 
    height: auto !important;
  }
  
  /* 이미지 컨테이너를 반응형으로 처리 */
  .img-op-section02-img-container {
    position: relative !important;
    top: auto !important;
    left: auto !important;
    width: 100% !important;
    height: auto !important;
    /* aspect-ratio로 비율 유지 (460px / 240px ≈ 1.92:1) */
    aspect-ratio: 460 / 240;
    margin: 0 auto;
  }
  
  .img-op-section02-img {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    display: block !important;
    margin: 0;
  }
  
  .img-op-section02 .div9 { 
    position: static !important; 
    margin-top: 12px; 
    text-align: center; 
  }

  /* Section03 metrics: stack */  
  .img-op-section03 > * { position: static !important; margin: 6px 0; }

  /* Section04 cards/illustrations: stack and center, prevent overflow */
  .img-op-section04 > * { position: static !important; margin: 6px 0; }
  .img-op-section04 img { max-width: 100%; height: auto; display: block; margin: 0 auto; }

  /* Section05 list: 2-column grid with inner scroll (columns flex and shrink safely) */
  .img-op-section05 .group-parent {
    position: static !important;
    width: 100% !important;
    height: auto;           /* grow with content: image + text */
    /* Show up to 4 cards (2 rows x 2 cols). Each card min-height ~260px, one row gap 12px */
    max-height: calc((260px * 2) + 12px);
    overflow-y: auto;
    overscroll-behavior: contain;
    display: grid;
    /* Two flexible columns that can shrink without overflow */
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px 12px; /* row col */
  }
  .img-op-section06 .group-container {
    position: static !important;
    width: 100% !important;
    height: auto;
    /* Show up to 4 cards (2 rows x 2 cols). Each card min-height ~260px, one row gap 12px */
    max-height: calc((260px * 2) + 12px);
    overflow-y: auto;
    overscroll-behavior: contain;
    display: grid;
    /* Two flexible columns that can shrink without overflow */
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px 12px; /* row col */
  }
  .img-op-section05 .rectangle-parent {
    position: relative !important;
    width: 100% !important;
    min-width: 0; /* allow grid children to shrink */
    box-sizing: border-box;
    min-height: 260px; /* ensure enough room for image + text */
    height: auto !important; /* override fixed height from base css */
    padding: 8px; /* give a bit of breathing room */
    border-radius: 8px;
    background: #fff; /* keep card look when base bg is removed */
  }
  /* Let inner elements flow under the image in responsive */
  .img-op-section05 .div17,
  .img-op-section05 .bytes,
  .img-op-section05 .div18 { position: static !important; margin-top: 6px; }
  /* Responsive font-size for bytes: minimum 20px, scales with viewport width */
  .img-op-section05 .bytes { 
    font-size: clamp(20px, 2.5vw, 22px) !important;
  }
  /* Long filenames: enforce single-line with ellipsis in responsive */
  .img-op-section05 .div17 {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap !important;
    display: block !important;
  }
  /* Ensure image participates in normal flow to avoid overlap */
  .img-op-section05 .group-child {
    position: relative !important;
    width: 100% !important;
    aspect-ratio: 1 / 1; /* 정사각형 유지 */
    height: auto !important;
    display: block;
    border-radius: 8px;
    z-index: 1;
    overflow: hidden;
  }
  .img-op-section05 .group-child img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  /* Section05: place label (div18) at top-right in responsive too */
  .img-op-section05 .rectangle-parent { position: relative !important; }
  .img-op-section05 .div18 {
    position: absolute !important;
    top: 8px;
    right: 8px;
    left: auto !important; /* override any base left */
    margin-top: 0;
    z-index: 2;
  }

  /* Section06 converted images: 2-column grid with image-first cards */
  .img-op-section06 > * { position: static !important; margin: 6px 0; }
  .img-op-section06 .group-container {
    position: static !important;
    width: 100% !important;
    height: auto;
    /* Show up to 4 cards (2 rows x 2 cols). Each card min-height ~260px, one row gap 12px */
    max-height: calc((260px * 2) + 12px);
    overflow-y: auto;
    overscroll-behavior: contain;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px 12px;
  }
  .img-op-section06 .parent {
    position: relative !important;
    width: 100% !important;
    min-width: 0;
    box-sizing: border-box;
    min-height: 260px;
    height: auto !important;
    padding: 8px;
    border-radius: 8px;
    background: #fff;
    display: flex;
    flex-direction: column;
    overflow: visible; /* ensure text can flow below image */
  }
  /* image container first */
  .img-op-section06 .group-child4 { 
    order: 1; 
    width: 100% !important; 
    aspect-ratio: 1 / 1; /* 정사각형 유지 */
    height: auto !important; 
    border-radius: 8px; 
    position: relative !important; 
    z-index: 1;
    overflow: hidden;
  }
  /* override inline height on the actual <img> inside group-child4 */
  .img-op-section06 .group-child4 img { 
    width: 100% !important; 
    height: 100% !important; 
    object-fit: cover; 
    object-position: center;
    border-radius: 8px; 
    display: block; 
  }
  /* text flows below image */
  .img-op-section06 .div35,
  .img-op-section06 .bytes6,
  .img-op-section06 .div36,
  .img-op-section06 .bytes7,
  .img-op-section06 .div37 { position: static !important; margin-top: 6px; z-index: 2; }
  .img-op-section06 .div35,
  .img-op-section06 .bytes6,
  .img-op-section06 .div36,
  .img-op-section06 .bytes7 { z-index: 2; }
  /* place section06 download area (div37) over image at top-right, like section05 div18 */
  .img-op-section06 .parent { position: relative !important; }
  .img-op-section06 .div37 {
    position: absolute !important;
    top: 8px;
    right: 8px;
    left: auto !important; /* override base left:390px */
    margin-top: 0;
    z-index: 3; /* above image */
  }
  /* filename single-line ellipsis */
  .img-op-section06 .div35 {
    overflow: hidden; 
    text-overflow: ellipsis;
    white-space: nowrap !important; 
    display: block !important; 
    order: 2; 
  }
  .img-op-section06 .bytes6 { order: 3; }
  .img-op-section06 .div36 { order: 4; }
  /* Responsive font-size for bytes7: minimum 20px, scales with viewport width */
  .img-op-section06 .bytes7 { 
    order: 5; 
    font-size: clamp(20px, 2.5vw, 24px) !important;
  }
  .img-op-section06 .div37 { order: 6; }
}

/* Mobile tuning (<=600px): padding and type scale */
@media (max-width: 600px) {
  /* 최상위 부모에 패딩 적용 (모바일에서도 일관성 유지) */
  .img-op {
    padding: 20px !important;
  }

  /* Section02: 모바일에서 패딩 조정 */
  .img-op-section02 {
    padding: 16px !important;
  }
  
  .img-op-section02-img-container {
    /* 모바일에서도 aspect-ratio 유지 */
    aspect-ratio: 460 / 240;
  }
  
  .img-op-section02-fullview-text {
    font-size: 14px !important;
  }
  
  .img-op-section02-fullview-text svg {
    width: 24px !important;
    height: 24px !important;
  }
  
  /* 모바일에서 호버 효과는 터치로 대체되므로 약간 조정 */
  .img-op-section02-img-container:active .img-op-section02-img {
    transform: scale(1.02) !important; /* 모바일에서는 확대 효과 약화 */
  }

  .img-op-section03 { grid-template-columns: 1fr; }
  /* Scale Section01 to always fit width while keeping 1020x580 ratio */
  .img-op-section01 { overflow-x: hidden !important; overflow-y: hidden !important; }
  .img-op-section01 .section01-scale-wrapper { --s: clamp(0.15, calc(100% / 1020px), 1); }
  /* Mobile: Section04 tighter spacing and simple 2 rows layout */
  .img-op-section04 {
    padding: 12px !important;
    margin-inline: 0; /* 최상위 부모 패딩 사용 */
  }

  .img-op-section04 .section04-title {
    font-size: 20px !important;
    line-height: 1.2 !important;
    margin-bottom: 12px !important;
  }

  .img-op .div1 { 
    margin: 0 0 8px 0; /* 최상위 부모 패딩 사용, 하단 마진만 유지 */
    font-size: 22px; 
    line-height: 1.25; 
  }

  /* Mobile: 개별 섹션의 margin-inline 제거 (최상위 부모 패딩 사용) */
  .img-op-section05,
  .img-op-section06 { margin-inline: 0; }

  /* Mobile: place section05 label (div18) over image at top-right */
  .img-op-section05 .rectangle-parent { position: relative !important; }
  .img-op-section05 .div18 {
    position: absolute !important;
    top: 8px;
    right: 8px;
    z-index: 2;
  }
  /* Ensure image stays behind */
  .img-op-section05 .group-child { position: relative; z-index: 1; }
  
  /* Mobile: Full image modal adjustments */
  .full-image-modal-content {
    width: 100% !important;
    padding: 50px 10px 10px 10px !important;
  }
  
  .full-image-modal-close {
    right: 10px !important;
    width: 40px !important;
    height: 40px !important;
    font-size: 32px !important;
    line-height: 40px !important;
  }
}
