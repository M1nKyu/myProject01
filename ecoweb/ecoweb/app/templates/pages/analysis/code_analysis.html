<!DOCTYPE html>
<html>
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JEP4QKW5CR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JEP4QKW5CR');
    </script>
  	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  	{% if meta %}
      <title>{{ meta.title }}</title>
    {% else %}
      <title>{{ _('code.page_title') }}</title>
    {% endif %}

  	<!-- Open Graph / Social Media Meta Tags -->
    {% include 'includes/meta/meta-tags.html' %}

    <!-- Structured Data (Schema.org JSON-LD) -->
    {% include 'includes/meta/structured-data.html' %}

  	<link rel="stylesheet"  href="{{ url_for('static', filename='css/pages/code_analysis/code_analysis.css') }}" />
      <link rel="stylesheet" href="{{ url_for('static', filename='css/common/global.css') }}" />
      <!-- Responsive overrides: common first, then page-specific -->
      <link rel="stylesheet" href="{{ url_for('static', filename='css/common/responsive-common.css', v='20250829-1') }}" />
      <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/code_analysis/responsive-code.css', v='20250829-1') }}" />
  	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&display=swap" />
</head>
<body data-task-id="{{ task_id }}">
    <!-- 페이지 로딩 화면 -->
    {% include 'includes/page-loader.html' %}

    <!-- Hidden input for task_id (fallback for older scripts) -->
    <input type="hidden" id="task-id" name="task_id" value="{{ task_id }}">

    {% include 'includes/new-header.html' %}
    {% include 'includes/sidebar.html' %}
  	<div class="code">
        {% include 'includes/user-bar.html' %}
        <!--title ==============================-->
        <div class="div1">{{ _('code.main_title') }}</div>

        <!--01. 리소스 비율 =========================================================================== -->
        <div class="code-section01">
            {% if view_data and view_data.get('total_byte_weight') %}
                {% set total_size = view_data.get('total_byte_weight', 0) if view_data.get('total_byte_weight', 0) > 0 else 1 %}

                <!-- 총 리소스 용량-->
                <div class="section01-total">

                    <!--상단-->
                    <div class="section01-total-title">{{ _('code.total_resource_title') }}</div>
                    <div class="section01-total-description">{{ _('code.total_resource_description') }}</div>
                    <div class="section01-total-co2-wrapper">
                        <div class="section01-co2-text">{{ co2_emissions.get('total_byte_weight', 0)|round(3) }}g CO2</div>
                    </div>

                    <!--바그래프-->
                    <div class="section01-total-bar-container">
                        <!-- 서드파티 -->
                        {% set third_party_percentage = (view_data.get('third_party_summary_wasted_bytes', 0) / total_size) * 100 if total_size > 0 else 0 %}
                        <div class="section01-total-bar-third-party" style="width: {{ [third_party_percentage, 100]|min|round(1) }}%;"></div>

                        <!-- 사용중JS : 전체JS - 미사용JS (하한 0) -->
                        {% set total_js_bytes = view_data.get('total_resource_bytes_script', 0) %}
                        {% set unused_js_bytes = view_data.get('total_unused_bytes_script', 0) %}
                        {% set used_js_bytes = [total_js_bytes - unused_js_bytes, 0]|max %}
                        {% set used_js_percentage = (used_js_bytes / total_size) * 100 if total_size > 0 else 0 %}
                        <div class="section01-total-bar-used-js" style="width: {{ [used_js_percentage, 100]|min|round(1) }}%;"></div>

                        <!-- 미사용JS -->
                        {% set unused_js_percentage = (unused_js_bytes / total_size) * 100 if total_size > 0 else 0 %}
                        <div class="section01-total-bar-unused-js" style="width: {{ [unused_js_percentage, 100]|min|round(1) }}%;"></div>

                        <!-- 미사용CSS -->
                        {% set unused_css_bytes = view_data.get('can_optimize_css_bytes', 0) %}
                        {% set unused_css_percentage = (unused_css_bytes / total_size) * 100 if total_size > 0 else 0 %}
                        <div class="section01-total-bar-unused-css" style="width: {{ [unused_css_percentage, 100]|min|round(1) }}%;"></div>

                        <!-- 다른 리소스 (나머지) -->
                        {% set accounted_bytes = view_data.get('third_party_summary_wasted_bytes', 0) + used_js_bytes + unused_js_bytes + unused_css_bytes %}
                        {% set other_bytes = [total_size - accounted_bytes, 0]|max %}
                        {% set other_percentage = (other_bytes / total_size) * 100 if total_size > 0 else 0 %}
                        <div class="section01-total-bar-other" style="width: {{ [other_percentage, 100]|min|round(1) }}%;"></div>
                    </div>
    
                    <!-- 가이드 -->
                    <div class="section01-total-guide">
                        <div class="section01-total-guide-item">
                            <div class="section01-total-guide-item-circle-01"></div>
                            <div class="section01-total-guide-text">{{ _('code.third_party_script') }}</div>
                        </div>
                        <div class="section01-total-guide-item">
                            <div class="section01-total-guide-item-circle-02"></div>
                            <div class="section01-total-guide-text">{{ _('code.used_javascript') }}</div>
                        </div>
                        <div class="section01-total-guide-item">
                            <div class="section01-total-guide-item-circle-03"></div>
                            <div class="section01-total-guide-text">{{ _('code.unused_javascript') }}</div>
                        </div>
                        <div class="section01-total-guide-item">
                            <div class="section01-total-guide-item-circle-04"></div>
                            <div class="section01-total-guide-text">{{ _('code.unused_css') }}</div>
                        </div>
                        <div class="section01-total-guide-item">
                            <div class="section01-total-guide-item-circle-05"></div>
                            <div class="section01-total-guide-text">{{ _('code.other_resources') }}</div>
                        </div>
                    </div>
                </div>

                <img class="child13" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-01.svg') }}">

                <!-- 세부 비율 -->
                <div class="code-section01-graph-content">
                    {% set item_key = 'third_party_summary_wasted_bytes' %}
                    {% set item_size = view_data.get(item_key, 0) %}
                    {% set percentage = (item_size / total_size) * 100 if total_size > 0 else 0 %}
                    <div class="inner1">
                        <div class="parent">
                            <div class="div13">{{ _('code.third_party_script') }} ({{ [percentage, 100]|min|round(1) }}%)</div>
                            <div class="javascript">{{ _('code.third_party_description') }}</div>
                            <div class="g-co2-container">
                                <div class="section01-co2-text">{{ co2_emissions.get(item_key, 0)|round(3) }}g CO2</div>
                            </div>
                            <div class="group-child21"></div>
                            <div class="group-child22" style="width: {{ [percentage, 100]|min|round(1) }}%;"></div>
                        </div>
                    </div>

                    <!-- JavaScript 분석 -->
                    {% set total_js_script_size = view_data.get('total_resource_bytes_script', 0) %}
                    {% set unused_js_script_size = view_data.get('total_unused_bytes_script', 0) %}
                    {% set used_js_script_size = view_data.get('used_js_script_size', total_js_script_size - unused_js_script_size) %}
                    {% set total_js_percentage = (total_js_script_size / total_size) * 100 if total_size > 0 else 0 %}
                    {% set used_js_percentage = (used_js_script_size / total_size) * 100 if total_size > 0 else 0 %}
                    {% set unused_js_percentage = (unused_js_script_size / total_size) * 100 if total_size > 0 else 0 %}

                    <!-- 사용 중 JavaScript -->
                    <div class="inner2">
                        <div class="parent">
                            <div class="div13">{{ _('code.used_javascript') }} ({{ [used_js_percentage, 100]|min|round(1) }}%)</div>
                            <div class="javascript">{{ _('code.used_javascript_description') }}</div>
                            <div class="g-co2-container">
                                <div class="section01-co2-text">{{ co2_emissions.get('used_js_script_size', 0)|round(3) }}g CO2</div>
                            </div>
                            <div class="group-child21"></div>
                            <div class="group-child24" style="width: {{ [used_js_percentage, 100]|min|round(1) }}%;"></div>
                        </div>
                    </div>

                    <!-- 미사용 JavaScript -->
                    <div class="inner5">
                        <div class="parent">
                            <div class="div13">{{ _('code.unused_javascript') }} ({{ [unused_js_percentage, 100]|min|round(1) }}%)</div>
                            <div class="javascript">{{ _('code.unused_javascript_description') }}</div>
                            <div class="div20">
                                <div class="div21">{{ _('code.reducible') }}</div>
                            </div>
                            <div class="g-co2-container">
                                <div class="section01-co2-text">{{ co2_emissions.get('total_unused_bytes_script', 0)|round(3) }}g CO2</div>
                            </div>
                            <div class="group-child21"></div>
                            <div class="group-child30" style="width: {{ [unused_js_percentage, 100]|min|round(1) }}%;"></div>
                        </div>
                    </div>

                    <!-- 전체 JavaScript -->
                    <div class="inner4">
                        <div class="parent">
                            <div class="div13">{{ _('code.total_javascript') }} ({{ [total_js_percentage, 100]|min|round(1) }}%)</div>
                            <div class="javascript">{{ _('code.total_javascript_description') }}</div>
                            <div class="g-co2-container">
                                <div class="section01-co2-text">{{ co2_emissions.get('total_resource_bytes_script', 0)|round(3) }}g CO2</div>
                            </div>
                            <div class="group-child21"></div>
                            <div class="group-child28" style="width: {{ [total_js_percentage, 100]|min|round(1) }}%;"></div>
                        </div>
                    </div>

                    <!-- 미사용 CSS -->
                    {% set item_key = 'can_optimize_css_bytes' %}
                    {% set item_size = view_data.get(item_key, 0) %}
                    {% set percentage = (item_size / total_size) * 100 if total_size > 0 else 0 %}
                    <div class="inner3">
                        <div class="parent">
                            <div class="div13">{{ _('code.unused_css') }} ({{ [percentage, 100]|min|round(1) }}%)</div>
                            <div class="javascript">{{ _('code.unused_css_description') }}</div>
                            <div class="g-co2-container">
                                <div class="kb">{{ co2_emissions.get(item_key, 0)|round(3) }}g CO2</div>
                            </div>
                            <div class="group-child21"></div>
                            <div class="group-child26" style="width: {{ [percentage, 100]|min|round(1) }}%;"></div>
                        </div>
                    </div>
                </div>

            {% else %}
                <div class="text-center p-5">
                    <p class="lead">{{ _('code.no_data') }}</p>
                </div>
            {% endif %}
        </div>

        <!--02. 코드 파일 탐색기 =======================================================================-->
        <div class="code-section02">
            <!-- This container will be styled by code_analysis.css -->
    		<div class="child"></div>
    		<div class="div18">{{ _('code.file_explorer_title') }}</div>
            <div id="file-explorer-container">
                <div class="inner6">
                    <div class="container">
                      <div class="div19">{{ _('code.sort_by_name') }}</div>
                      <img class="iconamoonarrow-up-2-duotone" alt="정렬 방향 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-arrow-down.svg') }}">
                    </div>
                </div>
                <div class="group-parent7">
                    {% macro render_tree(tree, depth=0) %}
                        {% for folder, content in tree.items() %}
                            {% if folder != '__files__' %}
                                <div class="folder-item css-parent" style="margin-left: {{ depth * 20 }}px; position: relative;">
                                    <div class="folder-content">
                                        <img class="polygon-icon" alt="폴더 확장 화살표" src="{{ url_for('static', filename='img/code_analysis/code-arrow-right.svg') }}">
                                        <img class="material-symbolsfolder-rounde-icon" alt="폴더 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-folder.svg') }}">
                                        <div class="etc truncate-text" title="{{ folder }}">{{ folder }}</div>
                                    </div>
                                    {% if depth == 0 %}
                                    <!-- Gauge base bar -->
                                    <div class="group-child32"></div>
                                    <!-- Gauge filled bar (width set by JS randomly 30-90% of 280px) -->
                                    <div class="group-child41 gauge-fill"></div>
                                    {% endif %}
                                </div>
                                <div class="folder-children" style="display: none;">
                                    {{ render_tree(content, depth + 1) }}
                                </div>
                                {# 최상위 폴더 블럭의 맨 아래에 구분선 배치: 마지막 항목 뒤에는 표시하지 않음 #}
                                {% if depth == 0 and not loop.last %}
                                <div class="folder-separator"></div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        {% if tree['__files__'] %}
                            {% for file in tree['__files__'] %}
                                <div class="file-item css-parent" style="margin-left: calc(-45px + {{ (depth + 1) * 20 }}px);">
                                    <img class="cifile-code-icon" alt="코드 파일 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-file-icon.svg') }}">
                                    <div class="etc truncate-text" title="{{ file }}">{{ file }}</div>
                                </div>
                            {% endfor %}
                        {% endif %}

                    {% endmacro %}
                    {{ render_tree(directory_structure, 0) }}
                </div>
            </div>
            <script>
            document.addEventListener('DOMContentLoaded', function () {
              try {
                const fills = document.querySelectorAll('.gauge-fill');
                fills.forEach(fill => {
                  // base bar is sibling .group-child32 (default width ~280px)
                  const base = fill.parentElement.querySelector('.group-child32');
                  // Prefer CSS variable if present
                  let pct = parseFloat(getComputedStyle(fill).getPropertyValue('--gauge-pct'));
                  if (isNaN(pct)) {
                    // fallback: derive from px width once
                    const baseWidth = base ? base.getBoundingClientRect().width : 280;
                    const fillWidthPx = parseFloat((fill.style.width || '0').replace('px',''));
                    pct = baseWidth ? Math.max(0, Math.min(100, (fillWidthPx / baseWidth) * 100)) : 0;
                  }
                  const ratio = Math.max(0, Math.min(1, pct / 100));
                  fill.classList.remove('low','mid','high');
                  if (ratio <= (1/3)) {
                    fill.classList.add('low');
                  } else if (ratio <= (2/3)) {
                    fill.classList.add('mid');
                  } else {
                    fill.classList.add('high');
                  }
                });
              } catch (e) {
                // no-op
              }
            });
            </script>
        </div>
    <script>
      // Randomize gauge widths for top-level folders (depth==0)
      // Base bar width is 280px per CSS; fill between 30% and 90%
      (function() {
        try {
          var fills = document.querySelectorAll('.code-section02 .gauge-fill');
          fills.forEach(function(el){
            var pct = Math.floor(Math.random() * 60) + 30; // 30-90
            // Set percentage via CSS variable so it scales with container
            el.style.setProperty('--gauge-pct', pct);
            el.title = '가이드라인 준수율: ' + pct + '%';
          });
        } catch (e) { /* no-op */ }
      })();
    </script>
     <!--title ==============================-->
        <div class="div2">{{ _('code.font_optimization_title') }}</div>

        <!--03. 폰트 등급 =======================================================================-->
        <div class="code-section03">
    		<img class="mask-group-icon" alt="폰트 최적화 일러스트" src="{{ url_for('static', filename='img/code_analysis/code-font.svg') }}">
            <div class="div4">{{ _('code.font_grade_text') }}</div>
            <div class="div3">
                {% if font_total_bytes < 512000 %}
                    {{ _('code.font_grade_very_good') }}
                {% elif font_total_bytes < 890880 %}
                    {{ _('code.font_grade_good') }}
                {% elif font_total_bytes < 1638400 %}
                    {{ _('code.font_grade_needs_improvement') }}
                {% else %}
                    {{ _('code.font_grade_urgent') }}
                {% endif %}
            </div>
    		<div class="div5">{{ _('code.font_grade_suffix') }}</div>
        </div>

        <!--04. 폰트 크기 및 배출량 =======================================================================-->
        <div class="code-section04">
    		<div class="section04-total-byte">
                <div class="mb">
                    <p class="p">{{ "%.3f"|format(font_total_bytes / (1024*1024)) if font_total_bytes else '0.000' }}</p>
                    <p class="p">MB</p>
                </div>
                <div class="div10">{{ _('code.total_file_size') }}</div>
            </div>

    		<div class="section04-total-emission">
                <div class="g-co2">
                    <p class="p">{{ "%.4f"|format(current_font_co2_emission) if current_font_co2_emission else '0.0000' }}g</p>
                    <p class="p">CO2</p>
                </div>
                <div class="co21">{{ _('code.total_co2_emission') }}</div>
            </div>
        </div>

        <!--05. 발견된 폰트 =======================================================================-->
        <div class="code-section05">
    		<div class="section05-title">{{ _('code.discovered_fonts_title') }}</div>

            <!-- <div class="section05-sorting-bar">
                <div class="section05-sorting-bar-item section05-sorting-bar-selected" data-filter="all">
                    <div class="filter-text">All {{ detailed_font_info|length if detailed_font_info else 0 }}</div>
                </div>
                <div class="section05-sorting-bar-item" data-filter="name">
                    <div class="filter-text">이름순</div>
                </div>
                <div class="section05-sorting-bar-item" data-filter="size">
                    <div class="filter-text">크기순</div>
                </div>
            </div> -->

            <!-- 검색바 -->
    		<!-- <div class="section05-search-bar">
                <img class="section05-search-bar-icon" alt="검색 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-search.svg') }}">
            </div> -->

            <div class="group-parent">
                {% if detailed_font_info and detailed_font_info|length > 0 %}
                    {% for font_item in detailed_font_info %}
                        <div class="group-container">
                            <div class="notosans-regular-parent">
                                <div class="notosans-regular" title="{{ font_item.name }}">{{ font_item.name }}</div>
                                <div class="group-child"></div>
                                <div class="kb-wrapper">
                                    <div class="kb">{{ (font_item.size / 1024)|round(1) }} KB</div>
                                </div>
                                <div class="group-item"></div>
                            </div>
                            <img class="group-inner" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-05.svg') }}">
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-secondary mt-2 py-2" role="alert" style="font-size: 0.85rem; color: #fff;">
                        <i class="fas fa-info-circle me-2"></i>{{ _('code.no_font_data') }}
                    </div>
                {% endif %}
            </div>

        </div>

        <!--06. 폰트 최적화 방안 =======================================================================-->
        <div class="code-section06">

    		<div class="section06-title">{{ _('code.font_optimization_plan') }}</div>

    		<div class="child14"></div>

            <div class="section06-before">
                <div class="before-heading">{{ _('code.before_optimization') }}</div>
                <div class="before-mb">{{ ((font_total_bytes | default(0)) / (1024*1024)) | round(3) }} MB</div>
                <div class="before-co2">{{ (current_font_co2_emission | default(0)) | round(3) }}g CO2</div>
            </div>

    		<div class="group">
                <div class="div16">{{ _('code.optimization_method') }}</div>
                <div class="div17">{{ _('code.file_size_reduction') }}</div>
                <div class="co22">{{ _('code.co2_reduction') }}</div>
                <img class="group-child31" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-06.svg') }}">
    		</div>

            <div class="vector-parent">
                <img class="group-child76" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-06.svg') }}">

                <div class="mb-parent1">
                      <div class="mb3">{{ ((font_total_bytes | default(0)) / (1024*1024)) | round(3) }} MB</div>
                      <div class="div24">{{ _('code.reduction_percent_100') }}</div>
                      <div class="g-co2-wrapper5">
                            <div class="woff">{{ (current_font_co2_emission | default(0)) | round(3) }}g CO2</div>
                      </div>
                      <div class="woff2-parent">
                            <div class="woff">{{ _('code.system_font') }}</div>
                            <img class="material-symbolsinfo-outline-icon" alt="정보 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-info.svg') }}">
                      </div>
                      <div class="code-section06-bar-100"></div>
                </div>
            </div>
            <div class="vector-group">
                <img class="group-child76" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-06.svg') }}">

                <div class="mb-parent1">
                      <div class="mb3">{{ (((font_total_bytes | default(0)) * (1 - 0.25)) / (1024*1024)) | round(3) }} MB</div>
                      <div class="div24">{{ _('code.reduction_percent_75') }}</div>
                      <div class="g-co2-wrapper5">
                            <div class="woff">{{ ((current_font_co2_emission | default(0)) * (1 - 0.25)) | round(3) }}g CO2</div>
                      </div>
                      <div class="woff2-parent">
                            <div class="woff">{{ _('code.subset_font') }}</div>
                            <img class="material-symbolsinfo-outline-icon" alt="정보 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-info.svg') }}">
                      </div>
                      <div class="code-section06-bar-75"></div>
                </div>
            </div>
            <div class="vector-parent1">
                <img class="group-child76" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-06.svg') }}">

                <div class="mb-parent1">
                      <div class="mb3">{{ (((font_total_bytes | default(0)) * (1 - 0.30)) / (1024*1024)) | round(3) }} MB</div>
                      <div class="div24">{{ _('code.reduction_percent_70') }}</div>
                      <div class="g-co2-wrapper5">
                            <div class="woff">{{ ((current_font_co2_emission | default(0)) * (1 - 0.30)) | round(3) }}g CO2</div>
                      </div>
                      <div class="woff2-parent">
                            <div class="woff">{{ _('code.variable_font') }}</div>
                            <img class="material-symbolsinfo-outline-icon" alt="정보 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-info.svg') }}">
                      </div>
                      <div class="code-section06-bar-70"></div>
                </div>
            </div>
            <div class="vector-parent2">
                <img class="group-child76" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-06.svg') }}">

                <div class="mb-parent1">
                      <div class="mb3">{{ (((font_total_bytes | default(0)) * (1 - 0.50)) / (1024*1024)) | round(3) }} MB</div>
                      <div class="div24">{{ _('code.reduction_percent_50') }}</div>
                      <div class="g-co2-wrapper5">
                            <div class="woff">{{ ((current_font_co2_emission | default(0)) * (1 - 0.50)) | round(3) }}g CO2</div>
                      </div>
                      <div class="woff2-parent">
                            <div class="woff">{{ _('code.woff2_font') }}</div>
                            <img class="material-symbolsinfo-outline-icon" alt="정보 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-info.svg') }}">
                      </div>
                      <div class="code-section06-bar-50"></div>
                </div>
            </div>
            <div class="vector-parent3">
                <img class="group-child76" alt="" src="{{ url_for('static', filename='img/code_analysis/code-line-06.svg') }}">

                <div class="mb-parent1">
                      <div class="mb3">{{ (((font_total_bytes | default(0)) * (1 - 0.55)) / (1024*1024)) | round(3) }} MB</div>
                      <div class="div24">{{ _('code.reduction_percent_45') }}</div>
                      <div class="g-co2-wrapper5">
                            <div class="woff">{{ ((current_font_co2_emission | default(0)) * (1 - 0.55)) | round(3) }}g CO2</div>
                      </div>
                      <div class="woff2-parent">
                            <div class="woff">{{ _('code.woff_font') }}</div>
                            <img class="material-symbolsinfo-outline-icon" alt="정보 아이콘" src="{{ url_for('static', filename='img/code_analysis/code-info.svg') }}">
                      </div>
                      <div class="code-section06-bar-45"></div>
                </div>
            </div>
        </div>
    </div>
        
  	<script>
    		var container1 = document.getElementById("container1");
    		if(container1) {
      			container1.addEventListener("click", function (e) {
        				// Add your code here
      			});
    		}
    		
    		var container2 = document.getElementById("container2");
    		if(container2) {
      			container2.addEventListener("click", function (e) {
        				// Add your code here
      			});
    		}
    		
    		var container4 = document.getElementById("container4");
    		if(container4) {
      			container4.addEventListener("click", function (e) {
        				// Add your code here
      			});
    		}
    </script>
    <script>
      console.log('--- Backend Data ---');
      console.log('directory_structure:', JSON.parse('{{ directory_structure | tojson | safe }}'));
      console.log('font_total_bytes:', JSON.parse('{{ font_total_bytes | tojson | safe }}'));
      console.log('current_font_co2_emission:', JSON.parse('{{ current_font_co2_emission | tojson | safe }}'));
      console.log('detailed_font_info:', JSON.parse('{{ detailed_font_info | tojson | safe }}'));
      console.log('font_optimization_data:', JSON.parse('{{ font_optimization_data | tojson | safe }}'));
      console.log('code_optimization_data:', JSON.parse('{{ code_optimization_data | tojson | safe }}'));

      const view_data = JSON.parse('{{ view_data | tojson | safe }}');
      console.log('view_data:', view_data);

      const co2_emissions = JSON.parse('{{ co2_emissions | tojson | safe }}');
      console.log('co2_emissions:', co2_emissions);

      // 주요 지표 디버깅
      console.log('=== 코드 분석 주요 지표 ===');
      console.log('total_byte_weight:', view_data.total_byte_weight, 'bytes');
      console.log('third_party_summary_wasted_bytes:', view_data.third_party_summary_wasted_bytes, 'bytes');
      console.log('total_resource_bytes_script:', view_data.total_resource_bytes_script, 'bytes');
      console.log('total_unused_bytes_script:', view_data.total_unused_bytes_script, 'bytes');
      console.log('can_optimize_css_bytes:', view_data.can_optimize_css_bytes, 'bytes');

      // 퍼센티지 계산 테스트
      const total_size = view_data.total_byte_weight || 1;
      const third_party_pct = (view_data.third_party_summary_wasted_bytes || 0) / total_size * 100;
      const unused_js_pct = (view_data.total_unused_bytes_script || 0) / total_size * 100;
      const unused_css_pct = (view_data.can_optimize_css_bytes || 0) / total_size * 100;

      console.log('=== 계산된 퍼센티지 ===');
      console.log('서드파티:', third_party_pct.toFixed(1), '%');
      console.log('미사용 JS:', unused_js_pct.toFixed(1), '%');
      console.log('미사용 CSS:', unused_css_pct.toFixed(1), '%');

      console.log('--- End of Backend Data ---');
    </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const folderItems = document.querySelectorAll('.folder-item');

        folderItems.forEach(item => {
            item.addEventListener('click', function(event) {
                // Stop the event from bubbling up to parent folders
                event.stopPropagation(); 

                const children = this.nextElementSibling;
                const icon = this.querySelector('.polygon-icon');

                if (children && children.classList.contains('folder-children')) {
                    if (children.style.display === 'none' || children.style.display === '') {
                        children.style.display = 'block';
                        icon.classList.add('open');
                    } else {
                        children.style.display = 'none';
                        icon.classList.remove('open');
                    }
                }
            });
        });
    });
</script>
<script>
    // Section05 Sorting Bar Filter functionality
    document.addEventListener('DOMContentLoaded', function() {
        const filterItems = document.querySelectorAll('.section05-sorting-bar-item');

        filterItems.forEach(item => {
            item.addEventListener('click', function() {
                // Remove selected class from all items
                filterItems.forEach(filterItem => {
                    filterItem.classList.remove('section05-sorting-bar-selected');
                });

                // Add selected class to clicked item
                this.classList.add('section05-sorting-bar-selected');

                // Get filter value
                const filterValue = this.getAttribute('data-filter');
                console.log('Code analysis sorting filter selected:', filterValue);

                // TODO: Implement sorting logic based on filterValue
                // 'all' - show all items
                // 'name' - sort by name
                // 'size' - sort by size
            });
        });
    });
</script>
</body>
</html>